<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sir Bravin Music Search & Downloader</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #0f0f23;
            color: #e0e0e0;
            min-height: 100vh;
            padding-bottom: 40px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            padding: 30px 0;
            border-bottom: 1px solid #333;
            margin-bottom: 30px;
        }
        
        h1 {
            font-size: 2.8rem;
            background: linear-gradient(90deg, #ff6b6b, #4ecdc4, #45b7d1);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 10px;
        }
        
        .tagline {
            font-size: 1.1rem;
            color: #aaa;
            margin-bottom: 20px;
        }
        
        .search-container {
            display: flex;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
            border-radius: 50px;
            overflow: hidden;
            max-width: 700px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .search-input {
            flex-grow: 1;
            padding: 18px 25px;
            border: none;
            background-color: #1a1a2e;
            color: #e0e0e0;
            font-size: 1.1rem;
            outline: none;
        }
        
        .search-btn {
            background: linear-gradient(90deg, #4ecdc4, #45b7d1);
            border: none;
            color: white;
            padding: 0 35px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .search-btn:hover {
            background: linear-gradient(90deg, #45b7d1, #4ecdc4);
        }
        
        .filters {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 10px 20px;
            background-color: #1a1a2e;
            border: 1px solid #333;
            color: #aaa;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .filter-btn.active, .filter-btn:hover {
            background-color: #4ecdc4;
            color: #0f0f23;
            border-color: #4ecdc4;
        }
        
        .results-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .song-card {
            background-color: #1a1a2e;
            border-radius: 15px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #333;
            position: relative;
        }
        
        .song-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            border-color: #4ecdc4;
        }
        
        .song-img {
            height: 200px;
            width: 100%;
            object-fit: cover;
            border-bottom: 1px solid #333;
        }
        
        .song-info {
            padding: 20px;
        }
        
        .song-title {
            font-size: 1.3rem;
            margin-bottom: 8px;
            color: #fff;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .song-artist {
            color: #4ecdc4;
            margin-bottom: 5px;
            font-size: 1rem;
        }
        
        .song-album {
            color: #aaa;
            font-size: 0.95rem;
            margin-bottom: 15px;
        }
        
        .song-meta {
            display: flex;
            justify-content: space-between;
            color: #777;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .preview-btn, .download-btn, .quality-btn {
            flex: 1;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
            text-decoration: none;
            font-weight: 600;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .preview-btn {
            background-color: #333;
            color: #fff;
        }
        
        .preview-btn:hover {
            background-color: #45b7d1;
            color: #0f0f23;
        }
        
        .download-btn {
            background: linear-gradient(90deg, #ff6b6b, #ff8e8e);
            color: white;
        }
        
        .download-btn:hover {
            background: linear-gradient(90deg, #ff8e8e, #ff6b6b);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        
        .quality-btn {
            background-color: #333;
            color: #fff;
        }
        
        .quality-btn:hover {
            background-color: #4ecdc4;
            color: #0f0f23;
        }
        
        .format-options {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            display: none;
        }
        
        .format-btn {
            flex: 1;
            padding: 8px;
            background-color: #2a2a3e;
            color: #aaa;
            border-radius: 5px;
            text-align: center;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.2s ease;
        }
        
        .format-btn:hover, .format-btn.active {
            background-color: #4ecdc4;
            color: #0f0f23;
        }
        
        .preview-player {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 350px;
            background-color: #1a1a2e;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            border: 1px solid #4ecdc4;
            z-index: 1000;
            display: none;
        }
        
        .player-header {
            padding: 15px;
            background: linear-gradient(90deg, #4ecdc4, #45b7d1);
            color: #0f0f23;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .player-header h3 {
            margin: 0;
            font-size: 1.2rem;
        }
        
        .close-player {
            background: none;
            border: none;
            color: #0f0f23;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .player-content {
            padding: 20px;
        }
        
        .player-song-info h4 {
            font-size: 1.1rem;
            margin-bottom: 5px;
            color: #fff;
        }
        
        .player-song-info p {
            color: #4ecdc4;
            margin-bottom: 15px;
        }
        
        audio {
            width: 100%;
            margin-bottom: 15px;
        }
        
        .player-controls {
            display: flex;
            gap: 10px;
        }
        
        .player-download-btn {
            flex: 1;
            padding: 12px;
            background: linear-gradient(90deg, #ff6b6b, #ff8e8e);
            color: white;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .player-download-btn:hover {
            background: linear-gradient(90deg, #ff8e8e, #ff6b6b);
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
            color: #4ecdc4;
            display: none;
        }
        
        .no-results {
            text-align: center;
            padding: 40px;
            grid-column: 1 / -1;
            color: #aaa;
        }
        
        .disclaimer {
            background-color: #1a1a2e;
            border-left: 4px solid #ff6b6b;
            padding: 20px;
            margin-top: 30px;
            border-radius: 5px;
            font-size: 0.9rem;
            line-height: 1.6;
        }
        
        .disclaimer h3 {
            color: #ff6b6b;
            margin-bottom: 10px;
        }
        
        .api-status {
            background-color: #1a1a2e;
            border-radius: 10px;
            padding: 15px;
            margin-top: 20px;
            border: 1px solid #333;
        }
        
        .api-status h3 {
            color: #4ecdc4;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .api-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }
        
        .api-item {
            background-color: #2a2a3e;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.85rem;
            color: #aaa;
            border-left: 3px solid #45b7d1;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            color: #777;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .results-container {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .search-container {
                border-radius: 10px;
            }
            
            .search-input {
                padding: 15px 20px;
            }
            
            .preview-player {
                width: calc(100% - 40px);
                bottom: 10px;
                right: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .results-container {
                grid-template-columns: 1fr;
            }
            
            .filters {
                gap: 10px;
            }
            
            .filter-btn {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-music"></i> sir bravin music</h1>
            <p class="tagline">Search, preview, and download millions of songs</p>
            
            <div class="search-container">
                <input type="text" class="search-input" id="searchInput" placeholder="Search for songs, artists, or YouTube URLs...">
                <button class="search-btn" id="searchBtn">Search</button>
            </div>
            
            <div class="filters">
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="pop">Pop</button>
                <button class="filter-btn" data-filter="rock">Rock</button>
                <button class="filter-btn" data-filter="hiphop">Hip Hop</button>
                <button class="filter-btn" data-filter="electronic">Electronic</button>
                <button class="filter-btn" data-filter="jazz">Jazz</button>
            </div>
        </header>
        
        <div class="loading" id="loading">
            <i class="fas fa-spinner fa-spin"></i> Searching for music...
        </div>
        
        <div class="results-container" id="resultsContainer">
            <!-- Song cards will be inserted here dynamically -->
        </div>
        
        <div class="api-status">
            <h3><i class="fas fa-bolt"></i> Active Download APIs</h3>
            <div class="api-list">
                <div class="api-item">GiftedTech API v2</div>
                <div class="api-item">GiftedTech API v1</div>
                <div class="api-item">David Cyril API</div>
                <div class="api-item">RapidAPI Services</div>
                <div class="api-item">YouTube DL</div>
                <div class="api-item">Multiple Fallbacks</div>
            </div>
        </div>
        
        <div class="disclaimer">
            <h3><i class="fas fa-exclamation-triangle"></i> Important Notice</h3>
            <p>This tool is for educational purposes only. Please respect copyright laws and only download music that you have rights to or that is in the public domain. Support artists by purchasing their music when possible.</p>
        </div>
        
        <footer>
            <p>sir bravin music &copy; 2025 | Powered by Multiple APIs</p>
        </footer>
    </div>

    <!-- Preview Player -->
    <div class="preview-player" id="previewPlayer">
        <div class="player-header">
            <h3><i class="fas fa-play-circle"></i> Preview Player</h3>
            <button class="close-player" id="closePlayer">&times;</button>
        </div>
        <div class="player-content">
            <div class="player-song-info">
                <h4 id="playerSongTitle">Song Title</h4>
                <p id="playerSongArtist">Artist Name</p>
            </div>
            <audio id="audioPlayer" controls>
                Your browser does not support the audio element.
            </audio>
            <div class="player-controls">
                <button class="player-download-btn" id="playerDownloadBtn">
                    <i class="fas fa-download"></i> Download MP3
                </button>
            </div>
        </div>
    </div>

    <!-- External Libraries -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    
    <script>
        // API Configuration
        const API_CONFIG = {
            apiKey: 'gifted_api_6kuv56877d',
            audioApis: [
                `https://api.giftedtech.web.id/api/download/ytdlv2?apikey=gifted_api_6kuv56877d&url=`,
                `https://api.giftedtech.web.id/api/download/ytdl?apikey=gifted_api_6kuv56877d&url=`,
                `https://apis.davidcyriltech.my.id/download/ytmp3?url=`,
                `https://apis.davidcyriltech.my.id/youtube/mp3?url=`
            ],
            videoApis: [
                `https://api.giftedtech.web.id/api/download/ytmp4?apikey=gifted_api_6kuv56877d&url=`,
                `https://iamtkm.vercel.app/downloaders/ytmp4?url=`,
                `https://apis.davidcyriltech.my.id/download/ytmp4?url=`,
                `https://api.giftedtech.web.id/api/download/ytv?apikey=gifted_api_6kuv56877d&url=`,
                `https://apis.davidcyriltech.my.id/youtube/mp4?url=`,
                `https://api.giftedtech.web.id/api/download/ytvideo?apikey=gifted_api_6kuv56877d&url=`
            ]
        };

        // Toastr Configuration
        toastr.options = {
            positionClass: "toast-top-right",
            preventDuplicates: true,
            progressBar: true,
            timeOut: 3000
        };

        // DOM Elements
        const elements = {
            searchInput: document.getElementById('searchInput'),
            searchBtn: document.getElementById('searchBtn'),
            resultsContainer: document.getElementById('resultsContainer'),
            loadingElement: document.getElementById('loading'),
            filterButtons: document.querySelectorAll('.filter-btn'),
            previewPlayer: document.getElementById('previewPlayer'),
            closePlayer: document.getElementById('closePlayer'),
            audioPlayer: document.getElementById('audioPlayer'),
            playerSongTitle: document.getElementById('playerSongTitle'),
            playerSongArtist: document.getElementById('playerSongArtist'),
            playerDownloadBtn: document.getElementById('playerDownloadBtn')
        };

        // State Management
        let currentFilter = 'all';
        let currentSearchTerm = '';
        let currentSongForPreview = null;
        let currentDownloadType = 'mp3';

        // Extended Music Database with YouTube IDs for real downloads
        const musicDatabase = [
            {
                id: 1,
                title: "Blinding Lights",
                artist: "The Weeknd",
                album: "After Hours",
                genre: "pop",
                duration: "3:22",
                size: "8.2 MB",
                year: "2020",
                img: "https://images.unsplash.com/photo-1493225457124-a3eb161ffa5f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80",
                youtubeId: "4NRXx6U8ABQ",
                previewUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3"
            },
            {
                id: 2,
                title: "Bohemian Rhapsody",
                artist: "Queen",
                album: "A Night at the Opera",
                genre: "rock",
                duration: "5:55",
                size: "13.7 MB",
                year: "1975",
                img: "https://images.unsplash.com/photo-1511379938547-c1f69419868d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80",
                youtubeId: "fJ9rUzIMcZQ",
                previewUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3"
            },
            {
                id: 3,
                title: "Sicko Mode",
                artist: "Travis Scott",
                album: "Astroworld",
                genre: "hiphop",
                duration: "5:13",
                size: "12.1 MB",
                year: "2018",
                img: "https://images.unsplash.com/photo-1470225620780-dba8ba36b745?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80",
                youtubeId: "6ONRf7h3Mdk",
                previewUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3"
            },
            {
                id: 4,
                title: "Stairway to Heaven",
                artist: "Led Zeppelin",
                album: "Led Zeppelin IV",
                genre: "rock",
                duration: "8:02",
                size: "18.4 MB",
                year: "1971",
                img: "https://images.unsplash.com/photo-1518609878373-06d740f60d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80",
                youtubeId: "QkF3oxziUI4",
                previewUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3"
            },
            {
                id: 5,
                title: "Bad Guy",
                artist: "Billie Eilish",
                album: "When We All Fall Asleep",
                genre: "pop",
                duration: "3:14",
                size: "7.4 MB",
                year: "2019",
                img: "https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80",
                youtubeId: "DyDfgMOUjCI",
                previewUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3"
            },
            {
                id: 6,
                title: "So What",
                artist: "Miles Davis",
                album: "Kind of Blue",
                genre: "jazz",
                duration: "9:22",
                size: "21.5 MB",
                year: "1959",
                img: "https://images.unsplash.com/photo-1415201364774-f6f0bb35f28f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80",
                youtubeId: "ylXk1LBvIqU",
                previewUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-6.mp3"
            },
            {
                id: 7,
                title: "One More Time",
                artist: "Daft Punk",
                album: "Discovery",
                genre: "electronic",
                duration: "5:20",
                size: "12.3 MB",
                year: "2000",
                img: "https://images.unsplash.com/photo-1511379938547-c1f69419868d?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80",
                youtubeId: "FGBhQbmPwH8",
                previewUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-7.mp3"
            },
            {
                id: 8,
                title: "Humble",
                artist: "Kendrick Lamar",
                album: "DAMN.",
                genre: "hiphop",
                duration: "2:57",
                size: "6.8 MB",
                year: "2017",
                img: "https://images.unsplash.com/photo-1519281682544-5f37c4b14c47?ixlib=rb-4.0.3&auto=format&fit=crop&w=1000&q=80",
                youtubeId: "tvTRZJ-4EyI",
                previewUrl: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3"
            }
        ];

        // Initialize
        displaySongs(musicDatabase);
        
        // Event Listeners
        elements.searchBtn.addEventListener('click', performSearch);
        elements.searchInput.addEventListener('keyup', function(event) {
            if (event.key === 'Enter') performSearch();
        });
        
        elements.filterButtons.forEach(button => {
            button.addEventListener('click', function() {
                elements.filterButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                currentFilter = this.getAttribute('data-filter');
                applyFilterAndSearch();
            });
        });
        
        elements.closePlayer.addEventListener('click', function() {
            elements.previewPlayer.style.display = 'none';
            elements.audioPlayer.pause();
        });
        
        elements.playerDownloadBtn.addEventListener('click', function() {
            if (currentSongForPreview) {
                downloadSongReal(currentSongForPreview, currentDownloadType);
            }
        });

        // Search Function
        function performSearch() {
            currentSearchTerm = elements.searchInput.value.trim().toLowerCase();
            
            // Check if it's a YouTube URL
            if (isYouTubeUrl(currentSearchTerm)) {
                handleYouTubeUrl(currentSearchTerm);
            } else {
                applyFilterAndSearch();
            }
        }

        // Check if input is YouTube URL
        function isYouTubeUrl(url) {
            return url.includes('youtube.com') || url.includes('youtu.be');
        }

        // Handle YouTube URL
        async function handleYouTubeUrl(url) {
            showLoading();
            
            try {
                const videoId = extractYouTubeId(url);
                if (videoId) {
                    const videoInfo = await fetchYouTubeInfo(videoId);
                    
                    // Add to results
                    const youtubeSong = {
                        id: Date.now(),
                        title: videoInfo.title,
                        artist: videoInfo.author,
                        album: "YouTube Video",
                        genre: "youtube",
                        duration: "N/A",
                        size: "N/A",
                        year: new Date().getFullYear(),
                        img: videoInfo.thumbnail,
                        youtubeId: videoId,
                        previewUrl: null,
                        isYouTube: true
                    };
                    
                    displaySongs([youtubeSong]);
                }
            } catch (error) {
                toastr.error("Failed to process YouTube URL");
                console.error(error);
            } finally {
                hideLoading();
            }
        }

        // Extract YouTube ID
        function extractYouTubeId(url) {
            const regExp = /^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#&?]*).*/;
            const match = url.match(regExp);
            return (match && match[7].length === 11) ? match[7] : false;
        }

        // Fetch YouTube Info
        async function fetchYouTubeInfo(videoId) {
            try {
                const response = await fetch(`https://noembed.com/embed?url=https://www.youtube.com/watch?v=${videoId}`);
                const data = await response.json();
                
                return {
                    title: data.title,
                    author: data.author_name,
                    thumbnail: data.thumbnail_url
                };
            } catch (error) {
                return {
                    title: "YouTube Video",
                    author: "YouTube",
                    thumbnail: `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`
                };
            }
        }

        // Apply Filter and Search
        function applyFilterAndSearch() {
            showLoading();
            
            setTimeout(() => {
                let filteredSongs = musicDatabase;
                
                if (currentFilter !== 'all') {
                    filteredSongs = filteredSongs.filter(song => 
                        song.genre === currentFilter
                    );
                }
                
                if (currentSearchTerm !== '') {
                    filteredSongs = filteredSongs.filter(song => 
                        song.title.toLowerCase().includes(currentSearchTerm) ||
                        song.artist.toLowerCase().includes(currentSearchTerm) ||
                        song.album.toLowerCase().includes(currentSearchTerm)
                    );
                }
                
                displaySongs(filteredSongs);
                hideLoading();
            }, 600);
        }

        // Display Songs
        function displaySongs(songs) {
            elements.resultsContainer.innerHTML = '';
            
            if (songs.length === 0) {
                elements.resultsContainer.innerHTML = `
                    <div class="no-results">
                        <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 15px;"></i>
                        <h3>No songs found</h3>
                        <p>Try a different search term or filter</p>
                    </div>
                `;
                return;
            }
            
            songs.forEach(song => {
                const songCard = createSongCard(song);
                elements.resultsContainer.appendChild(songCard);
            });
        }

        // Create Song Card
        function createSongCard(song) {
            const card = document.createElement('div');
            card.className = 'song-card';
            card.dataset.id = song.id;
            
            const formatOptions = song.isYouTube ? 
                `<div class="format-options" id="formatOptions${song.id}">
                    <div class="format-btn ${currentDownloadType === 'mp3' ? 'active' : ''}" data-format="mp3" data-song-id="${song.id}">MP3</div>
                    <div class="format-btn ${currentDownloadType === 'mp4' ? 'active' : ''}" data-format="mp4" data-song-id="${song.id}">MP4</div>
                    <div class="format-btn ${currentDownloadType === 'flac' ? 'active' : ''}" data-format="flac" data-song-id="${song.id}">FLAC</div>
                </div>` : '';
            
            card.innerHTML = `
                <img src="${song.img}" alt="${song.album}" class="song-img">
                <div class="song-info">
                    <h3 class="song-title">${song.title}</h3>
                    <p class="song-artist">${song.artist}</p>
                    <p class="song-album">${song.album} (${song.year})</p>
                    <div class="song-meta">
                        <span><i class="far fa-clock"></i> ${song.duration}</span>
                        <span><i class="fas fa-headphones"></i> ${song.genre}</span>
                        <span><i class="fas fa-weight-hanging"></i> ${song.size}</span>
                    </div>
                    <div class="action-buttons">
                        ${song.previewUrl ? `
                            <button class="preview-btn" data-id="${song.id}">
                                <i class="fas fa-play"></i> Preview
                            </button>
                        ` : `
                            <button class="preview-btn disabled" disabled>
                                <i class="fas fa-play"></i> No Preview
                            </button>
                        `}
                        <button class="download-btn" data-id="${song.id}">
                            <i class="fas fa-download"></i> Download
                        </button>
                    </div>
                    ${formatOptions}
                </div>
            `;
            
            return card;
        }

        // Event Delegation for Dynamic Elements
        elements.resultsContainer.addEventListener('click', function(e) {
            const target = e.target.closest('button');
            if (!target) return;
            
            const songId = target.dataset.id;
            if (!songId) return;
            
            const song = findSongById(songId);
            if (!song) return;
            
            if (target.classList.contains('preview-btn')) {
                if (!target.disabled) {
                    playPreview(song);
                }
            } else if (target.classList.contains('download-btn')) {
                downloadSongReal(song, currentDownloadType);
            } else if (target.classList.contains('quality-btn')) {
                const formatOptions = document.getElementById(`formatOptions${songId}`);
                if (formatOptions) {
                    formatOptions.style.display = formatOptions.style.display === 'flex' ? 'none' : 'flex';
                }
            }
        });

        // Handle format selection
        elements.resultsContainer.addEventListener('click', function(e) {
            if (e.target.classList.contains('format-btn')) {
                const format = e.target.dataset.format;
                const songId = e.target.dataset.songId;
                
                // Update active format
                document.querySelectorAll('.format-btn').forEach(btn => btn.classList.remove('active'));
                e.target.classList.add('active');
                
                currentDownloadType = format;
                
                // Update download button text
                const downloadBtn = e.target.closest('.song-card').querySelector('.download-btn');
                if (downloadBtn) {
                    downloadBtn.innerHTML = `<i class="fas fa-download"></i> Download ${format.toUpperCase()}`;
                }
            }
        });

        // Find Song by ID
        function findSongById(id) {
            return musicDatabase.find(song => song.id == id) || 
                   {id: id, title: "Unknown", artist: "Unknown", youtubeId: id};
        }

        // Play Preview
        function playPreview(song) {
            if (!song.previewUrl) {
                toastr.warning("No preview available for this song");
                return;
            }
            
            currentSongForPreview = song;
            
            // Update player info
            elements.playerSongTitle.textContent = song.title;
            elements.playerSongArtist.textContent = song.artist;
            
            // Set audio source
            elements.audioPlayer.src = song.previewUrl;
            
            // Update download button
            elements.playerDownloadBtn.innerHTML = `<i class="fas fa-download"></i> Download ${currentDownloadType.toUpperCase()}`;
            
            // Show player
            elements.previewPlayer.style.display = 'block';
            
            // Play audio
            elements.audioPlayer.play().catch(e => {
                toastr.warning("Could not play preview. Click the play button in the player.");
            });
            
            toastr.success("Playing preview...");
        }

        // Real Download Function using APIs
        async function downloadSongReal(song, type = 'mp3') {
            toastr.info(`Preparing ${type.toUpperCase()} download...`, "Processing", {
                timeOut: 5000
            });
            
            try {
                // Get YouTube URL
                const youtubeUrl = `https://www.youtube.com/watch?v=${song.youtubeId}`;
                
                // Get download URL from APIs
                const downloadUrl = await getDownloadUrlFromApi(youtubeUrl, type);
                
                if (!downloadUrl) {
                    throw new Error('Failed to get download URL');
                }
                
                // Create download link
                const link = document.createElement('a');
                link.href = downloadUrl;
                link.download = `${song.title} - ${song.artist}.${type}`;
                link.target = '_blank';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                toastr.success(`Download started! Saving as ${type.toUpperCase()}`);
                
            } catch (error) {
                console.error('Download error:', error);
                toastr.error('Download failed. Trying alternative method...');
                
                // Fallback to mock download
                downloadSongMock(song, type);
            }
        }

        // Get Download URL from APIs
        async function getDownloadUrlFromApi(youtubeUrl, type) {
            const apis = type === 'mp3' || type === 'flac' ? API_CONFIG.audioApis : API_CONFIG.videoApis;
            const encodedUrl = encodeURIComponent(youtubeUrl);
            
            // Try each API
            for (const api of apis) {
                try {
                    console.log(`Trying API: ${api}${encodedUrl}`);
                    
                    const response = await axios.get(`${api}${encodedUrl}`, {
                        timeout: 10000,
                        headers: {
                            'Accept': 'application/json'
                        }
                    });
                    
                    console.log('API Response:', response.data);
                    
                    // Parse response
                    let downloadUrl = null;
                    
                    if (response.data?.result?.download_url) {
                        downloadUrl = response.data.result.download_url;
                    } else if (response.data?.url) {
                        downloadUrl = response.data.url;
                    } else if (response.data?.audio_url) {
                        downloadUrl = response.data.audio_url;
                    } else if (response.data?.video_url) {
                        downloadUrl = response.data.video_url;
                    } else if (response.data?.downloadUrl) {
                        downloadUrl = response.data.downloadUrl;
                    } else if (response.data?.link) {
                        downloadUrl = response.data.link;
                    }
                    
                    if (downloadUrl) {
                        return downloadUrl;
                    }
                    
                } catch (error) {
                    console.log(`API failed: ${error.message}`);
                    continue;
                }
            }
            
            return null;
        }

        // Mock Download (Fallback)
        function downloadSongMock(song, type) {
            const fileName = `${song.title} - ${song.artist}.${type}`;
            const fileSize = type === 'mp3' ? '8.2 MB' : type === 'mp4' ? '25.4 MB' : '45.6 MB';
            
            toastr.info(`Simulating download: ${fileName} (${fileSize})`);
            
            // Visual feedback
            const downloadBtn = document.querySelector(`.download-btn[data-id="${song.id}"]`);
            if (downloadBtn) {
                const originalText = downloadBtn.innerHTML;
                downloadBtn.innerHTML = `<i class="fas fa-check"></i> Downloading...`;
                downloadBtn.style.background = 'linear-gradient(90deg, #4CAF50, #45a049)';
                
                setTimeout(() => {
                    downloadBtn.innerHTML = originalText;
                    downloadBtn.style.background = '';
                    toastr.success(`Download complete: ${fileName}`);
                }, 2000);
            }
        }

        // Utility Functions
        function showLoading() {
            elements.loadingElement.style.display = 'block';
        }
        
        function hideLoading() {
            elements.loadingElement.style.display = 'none';
        }

        // Initial Search
        window.addEventListener('load', function() {
            setTimeout(() => {
                elements.searchInput.value = "The Weeknd";
                performSearch();
            }, 1000);
        });

        console.log("Sir Bravin Music Downloader Initialized");
        console.log("APIs Available:", API_CONFIG);
    </script>
</body>
</html>
